{% extends 'base.html' %}

{% block title %}Новая запись{% endblock %}

{% block content %}
    <h1>Новая запись в блоге</h1>
    <form method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.description.label }}
            {{ form.description(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.images.label }}
            {{ form.images(class="form-control", id="form-image") }}
        </div>
        <div id="image-result" style="margin-top: 20px; margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px;"></div>
        <script>
            var blog_imgs = [];

            document.getElementById('form-image').addEventListener('change', function(e) {
                let file = e.target.files; // Получаем все выбранные файлы
                if (!file || file.length === 0) return;

                file = file[0];
                const previewContainer = document.getElementById('image-result');

                if (!file.type.startsWith('image/')) {
                    console.warn(`Файл "${file.name}" не является изображением`);
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64Data = e.target.result;

                    const imgWrapper = document.createElement('div');
                    imgWrapper.style.position = 'relative';
                    imgWrapper.style.width = "fit-content";

                    const imgPreview = document.createElement('img');
                    imgPreview.src = base64Data;
                    imgPreview.style.maxWidth = '100%';
                    imgPreview.style.height = '300px';
                    imgPreview.style.borderRadius = '10px';

                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'X';
                    deleteBtn.style.fontSize = "22px";
                    deleteBtn.style.position = 'absolute';
                    deleteBtn.style.width = "30px";
                    deleteBtn.style.height = "30px";
                    deleteBtn.style.top = '0';
                    deleteBtn.style.right = '0';
                    deleteBtn.className = 'btn-danger';
                    deleteBtn.style.border = 'none';
                    deleteBtn.style.borderRadius = '10px';
                    deleteBtn.style.cursor = 'pointer';
                    deleteBtn.onclick = function() { imgWrapper.remove(); };

                    imgWrapper.appendChild(imgPreview);
                    imgWrapper.appendChild(deleteBtn);
                    previewContainer.appendChild(imgWrapper);
                };

                reader.readAsDataURL(file);

                blog_imgs.push(file)
                console.log(blog_imgs)
                e.target.value = '';
            });
        </script>
        <button type="submit" class="btn btn-primary">Сохранить</button>
    </form>
{% endblock %}